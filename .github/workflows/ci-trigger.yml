name: Python CI

on:
  push:
    paths:
      - '**/*.py'
  pull_request:
    paths:
      - '**/*.py'

jobs:
  ci:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # 自動判斷是否有 requirements.txt 並安裝
      - name: Install dependencies (if requirements.txt exists)
        run: |
          if [ -f requirements.txt ]; then
            echo "Found requirements.txt. Installing..."
            pip install -r requirements.txt
          else
            echo "No requirements.txt found. Skipping dependency installation."
          fi

      # ✅ 1. 檢查 Python 語法是否正確（若錯誤會直接失敗並終止流程）
      - name: Syntax check
        run: |
          echo "Running syntax check..."
          python -m compileall -q .

      # ✅ 2. 嘗試執行所有 .py（若無法執行則中止 Push/PR）
      - name: Runtime check (execute all .py)
        run: |
          echo "Running runtime check..."
          for file in $(find . -name "*.py"); do
            echo "Testing $file ..."
            python "$file" || exit 1
          done


      # ✅ 3. Lint 檢查（不會中斷流程，即使有警告也允許 Push/PR）
      - name: Run flake8 (non-blocking)
        continue-on-error: true
        run: |
          pip install flake8
          echo "Running flake8 linting..."
          flake8 . || true
